{% extends "base.html" %}

{% block title %}{{ t.download_title }} - {{ t.site_title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Back Button -->
            <div class="mb-4">
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> {{ t.back_to_home }}
                </a>
            </div>
            
            <!-- Video Preview Card -->
            <div class="video-preview-card">
                <div class="row">
                    <div class="col-md-4">
                        {% if video_info.thumbnail %}
                        <div class="video-thumbnail">
                            <img src="{{ video_info.thumbnail }}" alt="{{ video_info.title }}" class="img-fluid rounded">
                            <div class="play-overlay">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-8">
                        <div class="video-info">
                            <h3 class="video-title">{{ video_info.title }}</h3>
                            
                            <div class="video-meta">
                                {% if video_info.uploader %}
                                <div class="meta-item">
                                    <i class="fas fa-user"></i>
                                    <span>{{ video_info.uploader }}</span>
                                </div>
                                {% endif %}
                                
                                {% if video_info.view_count %}
                                <div class="meta-item">
                                    <i class="fas fa-eye"></i>
                                    <span>{{ "{:,}".format(video_info.view_count) }} {{ t.views }}</span>
                                </div>
                                {% endif %}
                                
                                {% if video_info.like_count %}
                                <div class="meta-item">
                                    <i class="fas fa-heart"></i>
                                    <span>{{ "{:,}".format(video_info.like_count) }} {{ t.likes }}</span>
                                </div>
                                {% endif %}
                                
                                {% if video_info.duration %}
                                <div class="meta-item">
                                    <i class="fas fa-clock"></i>
                                    <span>{{ video_info.duration }}s</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Download Options -->
            <div class="download-options-card">
                <h4 class="mb-4">{{ t.select_quality }}</h4>
                
                {% if video_info.formats %}
                <div class="quality-options">
                    {% for format in video_info.formats %}
                    <div class="quality-option">
                        <div class="quality-info">
                            <span class="quality-label">{{ format.quality }}</span>
                            <span class="format-ext">.{{ format.ext }}</span>
                        </div>
                        
                        <a href="{{ url_for('download_file', url=url, quality=format.quality) }}" 
                           class="btn btn-success download-quality-btn">
                            <i class="fas fa-download"></i>
                            {{ t.download }}
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    {{ t.no_formats_available }}
                </div>
                {% endif %}
            </div>
            
            <!-- Download Instructions -->
            <div class="download-instructions">
                <h5>{{ t.download_instructions_title }}</h5>
                <ul>
                    <li>{{ t.instruction_1 }}</li>
                    <li>{{ t.instruction_2 }}</li>
                    <li>{{ t.instruction_3 }}</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Add loading state to download buttons
document.addEventListener('DOMContentLoaded', function() {
    const downloadButtons = document.querySelectorAll('.download-quality-btn');
    
    downloadButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> {{ t.downloading }}...';
            this.disabled = true;
            
            // Re-enable button after 5 seconds (in case download doesn't start)
            setTimeout(() => {
                this.innerHTML = originalText;
                this.disabled = false;
            }, 5000);
        });
    });
});
</script>
{% endblock %}
